<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú - Ìò∏ÌÖî Î°úÎ¥á ÏÑúÎπÑÏä§</title>
    {{>layout/header}}
    <link rel="stylesheet" href="/css/admin_style.css">
    <link rel="stylesheet" href="/css/toast.css">

</head>
<body>

<div class="overlay">
    <div class="admin-container">
        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
        {{>layout/aside}}

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <main class="main-content">
            <!-- Ìó§Îçî -->
            <div class="content-header">
                <h2><i class="fas fa-chart-line me-2"></i>ÎåÄÏãúÎ≥¥Îìú</h2>
                <div class="admin-user">
                    <span>Í¥ÄÎ¶¨ÏûêÎãò, ÌôòÏòÅÌï©ÎãàÎã§</span>
                    <i class="fas fa-user-circle"></i>
                    <button id="adminLogoutBtn" class="btn btn-sm btn-outline-danger ms-2">
                        Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>

            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Ïò§ÎäòÏùò Ï£ºÎ¨∏</div>
                        <div class="stat-icon blue">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="today-orders">{{foodOrders}} / {{productOrders}}</div>
                    <div class="stat-label">üçΩÔ∏è Î£∏ ÏÑúÎπÑÏä§ Ïàò / üì¶ Î¨ºÌíà ÏÑúÎπÑÏä§ Ïàò</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Ïò§ÎäòÏùò Îß§Ï∂ú</div>
                        <div class="stat-icon green">
                            <i class="fas fa-won-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="today-revenue">{{todayRevenue}}</div>
                    <div class="stat-label">Ï¥ù Îß§Ï∂úÏï°</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Î∞∞Îã¨ Ï§ë</div>
                        <div class="stat-icon orange">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="delivering-count">{{deliveringCount}}</div>
                    <div class="stat-label">ÌòÑÏû¨ Î∞∞Îã¨ Ï§ëÏù∏ Ï£ºÎ¨∏</div>
                    <div class="stat-change">
                        ÌèâÍ∑† Î∞∞Îã¨ ÏãúÍ∞Ñ: 12Î∂Ñ
                    </div>
                </div>
            </div>

            <!-- Î°úÎ¥á ÏÉÅÌÉú -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-robot me-2"></i>Î°úÎ¥á ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ</h3>
<!--                    <a href="#" class="card-action">ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ <i class="fas fa-arrow-right ms-1"></i></a>-->
                </div>
                <div class="robot-grid">
                    <div class="robot-status-item">
                        <div class="robot-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="robot-name">Mini</div>
                        <div class="robot-status-badge available">ÏÇ¨Ïö©Í∞ÄÎä•</div>
                        <div class="battery-info">
                            <i class="fas fa-battery-full text-success"></i> Î∞∞ÌÑ∞Î¶¨: 95%
                        </div>
                    </div>

                    <div class="robot-status-item">
                        <div class="robot-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="robot-name">Beta</div>
                        <div class="robot-status-badge charging">ÏàòÎ¶¨Ï§ë</div>
                        <div class="battery-info">
                            <i class="fas fa-battery-three-quarters text-warning"></i> Î∞∞ÌÑ∞Î¶¨: 72%
                        </div>
                    </div>

                    <div class="robot-status-item">
                        <div class="robot-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="robot-name">Gamma</div>
                        <div class="robot-status-badge charging">ÏàòÎ¶¨Ï§ë</div>
                        <div class="battery-info">
                            <i class="fas fa-battery-half text-warning"></i> Î∞∞ÌÑ∞Î¶¨: 68%
                        </div>
                    </div>

<!--                    <div class="robot-status-item">-->
<!--                        <div class="robot-avatar">-->
<!--                            <i class="fas fa-robot"></i>-->
<!--                        </div>-->
<!--                        <div class="robot-name">Delta</div>-->
<!--                        <div class="robot-status-badge charging">Ï∂©Ï†ÑÏ§ë</div>-->
<!--                        <div class="battery-info">-->
<!--                            <i class="fas fa-battery-quarter text-danger"></i> Î∞∞ÌÑ∞Î¶¨: 28%-->
<!--                        </div>-->
<!--                    </div>-->
                </div>
            </div>

            <div class="row">
                <!-- ÏãúÍ∞ÑÎåÄÎ≥Ñ Ï£ºÎ¨∏ Ï∂îÏù¥ -->
                <div class="col-lg-8">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-chart-area me-2"></i>ÏãúÍ∞ÑÎåÄÎ≥Ñ Ï£ºÎ¨∏ Ï∂îÏù¥</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="orderChart"
                                    data-hourly-orders='{{hourlyOrdersJson}}'></canvas>
                        </div>
                    </div>
                </div>

                <!-- Ïù∏Í∏∞ Î©îÎâ¥ ÏàúÏúÑ -->
                <div class="col-lg-4">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-trophy me-2"></i>Ïù∏Í∏∞ Î©îÎâ¥ TOP 5</h3>
                        </div>
                        <ul class="menu-rank-list">
                            {{#popularMenus}}
                                <li class="menu-rank-item">
                                    <div class="rank-number {{#isTop3}}top-{{rank}}{{/isTop3}}">{{rank}}</div>
                                    <div class="menu-info">
                                        <div class="menu-name">{{menuName}}</div>
                                        <div class="menu-category">{{category}}</div>
                                    </div>
                                    <div class="menu-orders">
                                        <div class="order-count">{{orderCount}}</div>
                                        <div class="order-label">Ï£ºÎ¨∏</div>
                                    </div>
                                </li>
                            {{/popularMenus}}
                            {{^popularMenus}}
                                <li class="menu-rank-item">
                                    <div class="menu-info">
                                        <div class="menu-name">Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>
                                    </div>
                                </li>
                            {{/popularMenus}}
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<div id="toast-container"></div>

<!--Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Î™®Îã¨Ï∞Ω-->
{{>layout/login}}

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script src="/js/app/admin.js"></script>
<script>
// ÏãúÍ∞ÑÎåÄÎ≥Ñ Ï£ºÎ¨∏ Ï∂îÏù¥ Ï∞®Ìä∏
const ctx = document.getElementById('orderChart').getContext('2d');
const orderChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00', '24:00'],
        datasets: [{
            label: 'Ï£ºÎ¨∏ Í±¥Ïàò',
            data: [2, 5, 8, 15, 12, 10, 18, 22, 16, 8],
            borderColor: '#2c5530',
            backgroundColor: 'rgba(44, 85, 48, 0.1)',
            tension: 0.4,
            fill: true,
            pointRadius: 5,
            pointBackgroundColor: '#2c5530',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointHoverRadius: 7
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    font: {
                        size: 12,
                        family: "'Segoe UI', sans-serif"
                    },
                    color: '#2c5530',
                    padding: 15
                }
            },
            tooltip: {
                backgroundColor: 'rgba(44, 85, 48, 0.9)',
                padding: 12,
                titleFont: {
                    size: 14
                },
                bodyFont: {
                    size: 13
                },
                cornerRadius: 8
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 5,
                    color: '#666',
                    font: {
                        size: 11
                    }
                },
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                ticks: {
                    color: '#666',
                    font: {
                        size: 11
                    }
                },
                grid: {
                    display: false
                }
            }
        }
    }
});

// Í∏àÏï° Ìè¨Îß∑ Ìï®Ïàò (Ïà´ÏûêÎ•º 3ÏûêÎ¶¨ÎßàÎã§ ÏΩ§Îßà Ï∂îÍ∞Ä)
function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§Ìñâ
document.addEventListener("DOMContentLoaded", function() {
    const statValue = document.getElementById("today-revenue");

    // ÏöîÏÜåÍ∞Ä ÏóÜÏúºÎ©¥ Ï¢ÖÎ£å
    if (!statValue) return;

    // input ÌÉúÍ∑∏Ïù∏ÏßÄ ÌôïÏù∏
    const isInput = statValue.tagName === "INPUT";

    // ÌòÑÏû¨ Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
    const currentValue = isInput ? statValue.value : statValue.textContent;

    // Í∞íÏù¥ ÏûàÏúºÎ©¥ Ìè¨Îß∑ Ï†ÅÏö©
    if (currentValue && currentValue.trim() !== "") {
        // Ïà´ÏûêÎßå Ï∂îÏ∂ú
        const numericValue = currentValue.replace(/[^0-9]/g, "");

        if (isInput) {
            statValue.value = "‚Ç©" + formatNumber(numericValue);
        } else {
            statValue.textContent = "‚Ç©" + formatNumber(numericValue);
        }
    }

    // (ÏÑ†ÌÉùÏÇ¨Ìï≠) input ÌÉúÍ∑∏ÎùºÎ©¥ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏßÅÏ†ë ÏûÖÎ†•Ìï† ÎïåÎèÑ Ìè¨Îß∑ Ï†ÅÏö©
    if (isInput) {
        statValue.addEventListener("input", function(e) {
            let value = e.target.value.replace(/[^0-9]/g, "");

            // ÏµúÎåÄ 11ÏûêÎ¶¨ÍπåÏßÄÎßå ÌóàÏö© (ÌïÑÏöî ÏóÜÏúºÎ©¥ ÏÇ≠Ï†ú Í∞ÄÎä•)
            if (value.length > 11) {
                value = value.slice(0, 11);
            }

            e.target.value = formatNumber(value);
        });
    }
});

</script>
{{>layout/footer}}
</body>
</html>